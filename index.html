<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>
</head>
<body onload="init();">
    <canvas id="testCanvas" width="1000" height="600"></canvas>
    <script>
        const TARGET_WIDTH = 60;
        const TARGET_HEIGHT = 30;
        const PLAYER_WIDTH = 100;
        const PLAYER_HEIGHT = 20;
        const BALL_RADIUS = 8;
        let targets = [];
        let stage;
        let player;
        let ball;

        const init = () => {
            stage = new createjs.Stage("testCanvas");
            createjs.Ticker.framerate === 60;
            createjs.Ticker.addEventListener("tick", tick);

            createBall();
            createPlayer();
            createTargetGrid();
        }

        const tick = () => {
            stage.update();

            if(ball.up){
                ball.y -= ball.ySpeed;
            }else{
                ball.y += ball.ySpeed;
            }

            if(ball.right){
                ball.x += ball.xSpeed;
            }else{
                ball.x -= ball.xSpeed;
            }

            for(let i = 0; i < targets.length; i++){
                if(checkCollision(ball, targets[i])){
                    removeTarget(targets[i])
                    targets.splice(i, 1);
                    i--;
                }
            }

            // Check if ball reached the walls
            if(ball.x + BALL_RADIUS >= stage.canvas.width){
                ball.x = stage.canvas.width - BALL_RADIUS;
                ball.right = false;
            }
            if(ball.x - BALL_RADIUS <= 0){
                ball.x = BALL_RADIUS;
                ball.right = true;
            }
            if(ball.y - BALL_RADIUS <= 0){
                ball.y = BALL_RADIUS;
                ball.up = false;
            }
            if(ball.y + BALL_RADIUS >= stage.canvas.height){
                ball.y = stage.canvas.height - BALL_RADIUS;
                ball.up = true;
            }

            ball.lastX = ball.x;
            ball.lastY = ball.y;
        }

        const checkCollision = (ball, target) =>{
            if(
                ball.x + BALL_RADIUS <= target.x - TARGET_WIDTH/2 ||
                ball.x - BALL_RADIUS >= target.x + TARGET_WIDTH/2 ||
                ball.y - BALL_RADIUS >= target.y + TARGET_HEIGHT/2 ||
                ball.y + BALL_RADIUS <= target.y - TARGET_HEIGHT/2
            ){
                return false;
            }

            return true;
        }

        const createTargetGrid = () => {
            for(let i = 0; i < 14; i++){
                for(let j = 0; j < 5; j++){
                    createTarget(i*(TARGET_WIDTH + 10) + 40, j*(TARGET_HEIGHT+5) + 20);
                }
            }
        }

        const createTarget = (x, y) => {
            let target = new createjs.Shape();
            target.graphics.beginFill('#FF1919');
            target.graphics.drawRect(0, 0, TARGET_WIDTH, TARGET_HEIGHT);
            target.graphics.endFill();
            stage.addChild(target);

            target.regX = TARGET_WIDTH / 2;
            target.regY = TARGET_HEIGHT / 2;
            target.x = x;
            target.y = y;

            targets.push(target);
        }

        const removeTarget = (target) => {
            createjs.Tween.get(target, {}).to({scaleX: 0, scaleY: 0}, 500)
        }

        const createBall = () => {
            ball = new createjs.Shape();
            ball.graphics.beginFill('Black');
            ball.graphics.drawCircle(0, 0, BALL_RADIUS);
            ball.x = stage.canvas.width / 2;
            ball.y = stage.canvas.height / 2;
            stage.addChild(ball);

            ball.up = true;
            ball.right = true;
            ball.xSpeed = 0;
            ball.ySpeed = 1;
            ball.lastX = 0;
            ball.lastY = 0;
        }

        const createPlayer = () => {
            player = new createjs.Shape();
            player.graphics.beginFill('#000000');
            player.graphics.drawRect(0, 0, PLAYER_WIDTH, PLAYER_HEIGHT);
            player.x = stage.canvas.width / 2 - (PLAYER_WIDTH/2);
            player.y = stage.canvas.height * 0.95;

            stage.addChild(player);
        }
    </script>
</body>
</html>